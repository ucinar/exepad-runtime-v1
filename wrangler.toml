name = "exepad-runtime-v1"
main = ".open-next/worker.js"
compatibility_date = "2025-11-17"
compatibility_flags = ["nodejs_compat"]

# Build configuration
[build]
command = "npm run build:cloudflare"

# Static assets configuration (replaces pages_build_output_dir)
[assets]
directory = ".open-next/assets"
binding = "ASSETS"

# Worker self-reference (required for caching)
[[services]]
binding = "WORKER_SELF_REFERENCE"
service = "exepad-runtime-v1"

# R2 incremental cache
[[r2_buckets]]
binding = "NEXT_INC_CACHE_R2_BUCKET"
bucket_name = "exepad-runtime-v1-cache"
preview_bucket_name = "exepad-runtime-v1-cache-preview"

# Durable Objects for caching (required by OpenNext)
[[durable_objects.bindings]]
name = "NEXT_CACHE_DO_QUEUE"
class_name = "DOQueueHandler"

[[durable_objects.bindings]]
name = "NEXT_TAG_CACHE_DO_SHARDED"
class_name = "DOShardedTagCache"

[[durable_objects.bindings]]
name = "NEXT_CACHE_DO_PURGE"
class_name = "BucketCachePurge"

# Durable Objects migrations
[[migrations]]
tag = "v1"
new_classes = ["DOQueueHandler", "DOShardedTagCache", "BucketCachePurge"]

# Environment variables
[env.production.vars]
NEXT_PUBLIC_BACKEND_URL = "https://backend.exepad.com"
NEXT_PUBLIC_API_URL = "https://backend.exepad.com"
RUNTIME_SERVICE_API_KEY = "13ff45abca7de8ba1318bdd7e95ebb72f82cfe6dbe484d0c1755e154aa0be0c6"

[vars]
NEXT_PUBLIC_BACKEND_URL = "https://backend.exepad.com"
NEXT_PUBLIC_API_URL = "https://backend.exepad.com"
RUNTIME_SERVICE_API_KEY = "13ff45abca7de8ba1318bdd7e95ebb72f82cfe6dbe484d0c1755e154aa0be0c6"

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1
